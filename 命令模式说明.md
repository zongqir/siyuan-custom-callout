# Callout 命令模式说明

## 🎯 核心逻辑

插件现在支持**双模式并存**，无需选择，两种方式都可用：

### 方式一：命令直达（高效）⚡
直接输入 `> @命令` 自动创建 Callout

### 方式二：菜单选择（直观）📋
输入 `>` 后弹出菜单，可视化选择

---

## 🔍 工作原理

### 命令检测逻辑

```typescript
// 检测是否是命令输入（@开头）
isCommandInput(text: string): boolean {
    return text.trim().startsWith('@');
}
```

### 智能判断流程

```
用户输入
  ↓
检测第一行文本
  ↓
┌─────────────┐
│ 是否 @开头？│
└─────────────┘
  ↙           ↘
是              否
  ↓              ↓
执行命令        显示菜单
自动应用样式    可视化选择
```

### 关键特性

1. **实时检测**：输入时立即判断
2. **智能切换**：
   - 输入 `@` → 自动识别为命令，**不显示菜单**
   - 空引用块 → 显示菜单
   - 有内容但非命令 → 正常处理
3. **无冲突**：两种模式互不干扰

---

## 📝 使用示例

### 示例 1：命令模式

```markdown
> @info
这是一个信息块

# 效果：
✅ 直接创建，无菜单弹出
✅ 自动应用 info 样式
```

### 示例 2：中文命令

```markdown
> @技巧
这是一个技巧块

# 效果：
✅ 支持中文命令
✅ 同样直接创建
```

### 示例 3：菜单模式

```markdown
>
（此时会弹出菜单）

# 效果：
📋 显示可视化菜单
📋 鼠标或键盘选择
```

---

## 🔧 代码改动

### 1. `processor.ts` - 新增方法

```typescript
// 检测是否是命令
isCommandInput(text: string): boolean

// 根据命令查找类型
findTypeByCommand(command: string): CalloutTypeConfig | null

// 获取引用块第一行文本
getBlockquoteFirstLineText(blockquote: HTMLElement): string
```

### 2. `manager.ts` - 智能判断

**MutationObserver**：
```typescript
const text = this.processor.getBlockquoteFirstLineText(bq);
const isCommand = this.processor.isCommandInput(text);

// 只有不是命令时才显示菜单
if (!isCommand && ...) {
    this.menu.showMenu(...);
}
```

**Input 事件**：
```typescript
if (this.processor.isCommandInput(text)) {
    this.menu.hideMenu(true);  // 隐藏菜单
    this.processor.processBlockquote(blockquote);  // 处理命令
} else if (isEmpty) {
    this.menu.showMenu(...);  // 显示菜单
}
```

---

## ✨ 优势总结

| 特性 | 命令模式 | 菜单模式 |
|------|---------|---------|
| 速度 | ⚡ 极快 | 🐢 较慢 |
| 学习成本 | 📚 需记命令 | 👶 零门槛 |
| 适合人群 | 老手 | 新手 |
| 使用场景 | 快速笔记 | 探索功能 |
| Obsidian风格 | ✅ 完全一致 | ❌ 思源特色 |

---

## 🎉 最终效果

✅ **完全兼容 Obsidian Callout 语法**
✅ **保留思源可视化菜单特色**
✅ **两种模式无缝切换**
✅ **触发词配置不再是摆设**

你现在可以：
1. 像 Obsidian 一样输入 `> @info` 快速创建
2. 或者像之前一样用菜单选择
3. 甚至混合使用两种方式！

---

## 🚀 下一步

刷新思源，测试：

1. **命令模式**：
   ```
   > @info
   测试信息块
   ```

2. **中文命令**：
   ```
   > @技巧
   测试技巧块
   ```

3. **菜单模式**：
   ```
   >
   （等待菜单弹出）
   ```

4. **混合模式**：
   - 有时用命令
   - 有时用菜单
   - 完全自由！



