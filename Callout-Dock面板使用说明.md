# Callout Dock 面板使用说明

## 功能介绍

Callout Dock 面板是一个优雅的侧边栏工具，可以将当前文档中的所有 Callout 以缩略卡片的形式展示，方便快速浏览和跳转。

## 主要特性

### 1. **美观的卡片式设计** 🎨
- 每个 Callout 以精美的卡片形式展示
- 保留原有的主题色和图标
- 渐变背景和彩色边框
- 左侧色条标识 Callout 类型

### 2. **智能内容预览** 📖
- 显示 Callout 类型标签
- 展示标题（如果有）
- 预览部分内容（最多3行）
- 折叠状态指示器

### 3. **快速跳转** 🚀
- 点击卡片即可跳转到对应的 Callout
- 平滑滚动动画
- 自动高亮目标 Callout（2秒）

### 4. **实时同步** 🔄
- 自动检测文档切换
- 每2秒自动刷新内容
- 无需手动刷新

### 5. **响应式交互** ✨
- Hover 悬浮效果
- 卡片提升动画
- 跳转图标渐显

## 如何使用

### 打开 Dock 面板

1. 插件加载后，在右侧边栏会自动注册 "Callout 大纲" Dock
2. 点击右侧边栏的 Callout 图标打开面板
3. 面板默认位置在右下角，可以拖拽调整

### 浏览 Callout

- **头部信息**：显示 "Callout 大纲" 标题和总数量徽章
- **卡片列表**：滚动查看所有 Callout
- **空状态**：如果文档没有 Callout，会显示提示信息

### 跳转到 Callout

- 点击任意卡片
- 页面会平滑滚动到对应的 Callout
- 目标 Callout 会高亮显示2秒

## UI 设计细节

### 卡片结构

```
┌─────────────────────────────────┐
│ ┃ 🔵 [信息说明] [折叠标识]      │  ← 头部（图标+类型）
│ ┃                                │
│ ┃ 这是标题                       │  ← 标题（可选）
│ ┃                                │
│ ┃ 这是内容预览，最多显示三行...  │  ← 内容预览
│ ┃                                │
│ ┃                        [→]     │  ← 跳转图标（Hover显示）
└─────────────────────────────────┘
```

### 色彩系统

- 每个 Callout 类型使用各自的主题色
- 边框：2px 实线，使用主题色
- 背景：渐变背景，从浅色到白色
- 左侧色条：4px 宽，使用主题色
- 类型标签：主题色背景，白色文字

### 交互反馈

1. **Hover 效果**
   - 卡片上移 2px
   - 显示阴影
   - 显示跳转图标

2. **点击效果**
   - 卡片瞬间回到原位
   - 触发跳转动画

3. **高亮效果**
   - 目标添加 `protyle-wysiwyg--select` 类
   - 2秒后自动移除

## 技术实现

### 数据获取

使用思源 SQL API 查询当前文档的所有引述块：

```sql
SELECT b.id, b.content, b.markdown 
FROM blocks b 
WHERE b.root_id = '{docId}' 
AND b.type = 'b'
ORDER BY b.created ASC
```

### Callout 解析

- 解析 markdown 格式的 Callout 命令
- 提取类型、参数、折叠状态
- 从 HTML 内容中提取纯文本预览

### 自动更新机制

- 定时器：每2秒检查一次
- 文档切换检测：监听点击事件
- 防重复加载：缓存当前文档 ID

## 最佳实践

### 1. 为 Callout 添加有意义的标题
```markdown
> [!info]
> 重要提示
> 这里是详细内容...
```

### 2. 使用不同类型的 Callout
- 信息说明 `[!info]`
- 概念解释 `[!concept]`
- 示例演示 `[!example]`
- 使用技巧 `[!tip]`
- ...（11种类型）

### 3. 合理使用折叠功能
```markdown
> [!info]-   # 默认折叠
> [!info]+   # 默认展开
```

## 性能优化

- **按需加载**：只加载当前文档的 Callout
- **防抖机制**：避免频繁重复查询
- **虚拟滚动**：大量 Callout 时依然流畅（未来可能添加）

## 兼容性

- ✅ 支持所有 Callout 类型
- ✅ 支持中英文
- ✅ 支持明暗主题
- ✅ 支持移动端（响应式设计）

## 未来计划

- [ ] 搜索和过滤功能
- [ ] 按类型分组显示
- [ ] 拖拽排序
- [ ] 导出 Callout 列表
- [ ] 虚拟滚动优化

## 常见问题

### Q: Dock 面板没有显示？
A: 确保插件已加载，检查右侧边栏是否有 Callout 图标。

### Q: 内容不更新？
A: 面板会自动每2秒刷新，切换文档后会自动更新。

### Q: 点击卡片没有跳转？
A: 确保目标 Callout 还在文档中，没有被删除。

### Q: 显示空状态？
A: 当前文档确实没有 Callout，或 Callout 格式不正确。

---

**享受更高效的笔记体验！** 📝✨

