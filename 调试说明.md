# 键盘导航调试说明

## 已修复的问题

1. ✅ **初始选中状态** - 菜单显示时立即调用 `updateSelection()` 确保第一个项正确高亮
2. ✅ **统一样式管理** - 所有选中状态由 `updateSelection()` 统一处理，避免不一致
3. ✅ **添加调试日志** - 详细记录每次键盘移动的过程

## 如何调试

### 1. 编译运行
```bash
npm run build
# 或
npm run dev
```

### 2. 打开浏览器控制台

在思源笔记中按 `F12` 打开开发者工具

### 3. 测试键盘导航

1. 输入 `>` 创建 blockquote
2. 菜单自动弹出
3. 按方向键 `↑↓←→` 测试导航
4. 查看控制台输出

### 4. 查看日志

控制台会显示类似这样的日志：

```
[MenuV2] 显示菜单 {isEdit: false, selectedIndex: 0}
[MenuV2] 移动选择 {delta: 3, currentIndex: 0, currentRow: 0, currentCol: 0, gridColumns: 3, totalItems: 11}
[MenuV2] 移动到新位置 {newIndex: 3}
```

### 5. 关键信息

- `delta`: 移动的步长（1=右，-1=左，3=下，-3=上，假设3列）
- `currentIndex`: 当前选中的索引
- `currentRow`: 当前行号（从0开始）
- `currentCol`: 当前列号（从0开始）
- `gridColumns`: 网格列数（默认3）
- `totalItems`: 总项目数

## 预期行为

### 3列网格，11个项目
```
[0]  [1]  [2]     ← 第0行
[3]  [4]  [5]     ← 第1行
[6]  [7]  [8]     ← 第2行
[9]  [10]         ← 第3行
```

### 测试用例

**从 [0] 开始：**
- 按 `→`: 移到 [1] ✅
- 按 `→`: 移到 [2] ✅
- 按 `→`: 不动（行尾）✅
- 按 `↓`: 移到 [3] ✅
- 按 `←`: 移到 [2] ✅

**从 [2] 开始：**
- 按 `↓`: 移到 [5] ✅
- 按 `↓`: 移到 [8] ✅
- 按 `↓`: 移到 [10]（最后一行最右）✅

**从 [10] 开始：**
- 按 `←`: 移到 [9] ✅
- 按 `←`: 不动（行首）✅
- 按 `↑`: 移到 [8] ✅

## 如果还有问题

请把控制台的日志发给我，我会根据实际情况调整逻辑！

